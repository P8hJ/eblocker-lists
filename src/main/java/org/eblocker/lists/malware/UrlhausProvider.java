package org.eblocker.lists.malware;

import org.eblocker.server.common.malware.MalwareEntry;

import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.Stream;

public class UrlhausProvider implements MalwareProvider {
    private final UrlhausDownloader downloader;

    public UrlhausProvider(UrlhausDownloader downloader) {
        this.downloader = downloader;
    }

    @Override
    public MalwareEntries getMalwareEntries() throws MalwareListException {
        Stream<UrlhausEntry> urlhausEntries = downloader.retrieveEntries();
        List<MalwareEntry> urls = urlhausEntries
                .map(this::mapUrlhausToMalwareEntry)
                .collect(Collectors.toList());
        return new MalwareEntries(urls);
    }

    private MalwareEntry mapUrlhausToMalwareEntry(UrlhausEntry urlhausEntry) {
        return new MalwareEntry(removeScheme(urlhausEntry), new String[]{ malwareInfo(urlhausEntry) });
    }

    private String malwareInfo(UrlhausEntry urlhausEntry) {
        return urlhausEntry.getThreat() + ": " + urlhausEntry.getTags();
    }

    private String removeScheme(UrlhausEntry urlhausEntry) {
        return urlhausEntry.getUrl().replace("http://", "").replace("https://", "");
    }
}
